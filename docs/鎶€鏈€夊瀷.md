# 技术选型文档

## 🎯 技术选型原则

### 1. 全栈一体化
- 选择 Next.js 作为全栈框架，减少前后端分离的复杂性
- 统一的技术栈，提高开发效率和代码一致性

### 2. 现代化技术栈
- 优先使用 TypeScript 提供类型安全
- 采用最新的 Next.js App Router 架构
- 集成主流云服务和第三方 API

### 3. 可扩展性设计
- 模块化 API 路由设计
- 云服务集成支持业务增长
- 清晰的代码组织结构

---

## 🏗️ 顶层架构设计

### 整体架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端界面      │    │   Next.js      │    │   外部服务      │
│   (React)      │◄──►│   API 路由     │◄──►│   (云服务)      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                              ▼
                       ┌─────────────────┐
                       │   MongoDB      │
                       │   (数据库)     │
                       └─────────────────┘
```

### 技术栈分层
1. **表现层**：React + TypeScript + Tailwind CSS
2. **应用层**：Next.js App Router + API Routes
3. **数据层**：MongoDB + Mongoose
4. **服务层**：第三方云服务集成

---

## 🚀 前端技术选型

### 核心框架
- **Next.js 15.3.2** - 全栈 React 框架
- **React 19.0.0** - 用户界面构建
- **TypeScript 5.8.3** - 类型安全开发

### 关键组件库
- **NextAuth.js** - 身份认证与会话管理
- **Stripe.js** - 支付组件集成
- **Sharp** - 图像处理库
- **Tailwind CSS** - 原子化 CSS 框架

### 组件设计思路
- 采用函数式组件 + Hooks 模式
- 组件职责单一，便于复用和维护
- 使用 TypeScript 接口定义组件 Props
- 响应式设计，适配多设备

---

## 🔧 后端技术选型

### 核心框架
- **Next.js API Routes** - 后端接口实现
- **Node.js** - JavaScript 运行时环境

### 数据存储
- **MongoDB** - 文档型数据库
- **Mongoose** - MongoDB ODM，数据模型管理

### 认证系统
- **NextAuth.js** - 多种认证策略支持
- **JWT** - 无状态认证令牌
- **Google OAuth 2.0** - 第三方登录集成

---

## 🗄️ 数据库设计

### 核心数据模型
```typescript
// 用户模型
interface User {
  email: string;
  name: string;
  subscription: Subscription;
  usage: Usage;
}

// 图片模型
interface Image {
  userId: string;
  originalUrl: string;
  transformedUrl: string;
  style: string;
  status: string;
}
```

### 数据库选型理由
- **MongoDB**：灵活的数据结构，适合文档存储
- **Mongoose**：提供数据验证、中间件、类型安全

---

## 🔌 第三方服务集成

### 核心服务
| 服务 | 用途 | 集成方式 |
|------|------|----------|
| **Stripe** | 支付处理与订阅管理 | REST API + Webhooks |
| **OpenAI API** | AI 图像生成与编辑 | REST API |
| **AWS S3** | 文件存储 | AWS SDK |
| **Google OAuth** | 用户身份验证 | OAuth 2.0 |

### 集成设计思路
- 统一的服务配置管理
- 错误处理和重试机制
- 环境变量配置，支持多环境部署

---

## 📁 项目结构设计

### 目录组织
```
app/
├── api/                    # API 路由
│   ├── auth/              # 认证相关
│   ├── user/              # 用户数据
│   ├── upload/            # 文件上传
│   ├── transform/         # 图像转换
│   └── stripe/            # 支付处理
├── components/             # 可复用组件
├── lib/                   # 工具库
├── models/                # 数据模型
└── types/                 # 类型定义
```

### 架构设计原则
- **关注点分离**：UI、业务逻辑、数据访问分离
- **模块化设计**：每个功能模块独立，便于维护
- **类型安全**：TypeScript 全覆盖，减少运行时错误

---

## 🎨 核心功能实现

### 用户认证流程
1. 前端调用 Google OAuth
2. NextAuth.js 处理认证逻辑
3. 创建/更新用户数据到 MongoDB
4. 返回 JWT 令牌

### 图片处理流程
1. 前端上传图片到 S3
2. 调用 OpenAI API 进行风格转换
3. 保存转换结果到 S3
4. 更新数据库记录

### 支付订阅流程
1. 前端集成 Stripe 支付组件
2. 后端创建支付意图
3. Stripe Webhook 处理支付结果
4. 更新用户订阅状态

---

## 🚀 技术优势

### 1. 开发效率
- **全栈框架**：减少前后端分离的复杂性
- **类型安全**：TypeScript 编译时错误检查
- **热重载**：Turbopack 快速开发体验

### 2. 性能表现
- **SSR/SSG**：更好的首屏加载和 SEO
- **图片优化**：自动格式转换和尺寸优化
- **CDN 集成**：全球内容分发

### 3. 可维护性
- **模块化设计**：清晰的代码结构
- **统一技术栈**：减少学习成本
- **标准化**：遵循 Web 标准

---

## 📚 技术选型总结

本项目采用的技术栈体现了现代 Web 开发的顶层设计思路：

### 核心架构
- **前端**：React + TypeScript + Next.js
- **后端**：Next.js API Routes + Node.js
- **数据库**：MongoDB + Mongoose
- **认证**：NextAuth.js + Google OAuth

### 设计理念
1. **全栈一体化**：减少技术栈复杂度
2. **类型安全**：提高代码质量和开发效率
3. **云原生**：集成主流云服务，支持业务扩展
4. **模块化**：清晰的代码组织，便于维护和扩展

这个技术栈适合作为全栈开发教学的典型案例，涵盖了前端、后端、数据库、云服务等多个技术领域，体现了现代 Web 应用的完整技术架构。
