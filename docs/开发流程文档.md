# Ghibli Dreamer 产品开发流程文档

## 一、产品功能说明

### 1. 用户登录
- 仅支持 Google 第三方登录。
- 未登录用户有 1 次免费体验机会，之后需登录并订阅。

### 2. 订阅系统
- 登录后可订阅，订阅用户可无限制使用全部功能。
- 支持取消订阅。

### 3. 图片上传与预览
- 支持本地图片上传（头像、宠物、风景等）。
- 上传后可立即预览图片。

### 4. 风格选择与转换
- 支持选择"Ghibli Style"风格。
- 点击"Transform Now"按钮进行风格转换。
- 未登录用户仅可免费转换 1 次，之后需登录并订阅。

### 5. 结果预览与下载
- 转换完成后可预览 Ghibli 风格图片。
- 支持下载高清图片。

---

## 二、技术方案

### 1. 前端
- 框架：React（推荐 Next.js，支持 SSR 和 SEO）
- UI：Tailwind CSS 或 Ant Design
- 图片上传与预览：`<input type="file" />` + FileReader
- 登录：Google OAuth（如 Firebase Auth）
- 状态管理：React Context 或 Redux
- 网络请求：Axios 或 Fetch API

### 2. 后端
- 框架：Node.js + Express 或 Next.js API Routes
- 用户认证：JWT + Google OAuth
- 图片处理：调用 AI 风格转换 API（如 Stable Diffusion、Replicate、或自建模型）
- 订阅管理：Stripe（推荐，支持订阅和支付）
- 数据库：MongoDB 或 PostgreSQL（存储用户、订阅、图片记录等）

### 3. 云服务与部署
- 图片存储：AWS S3、Cloudinary 或本地存储
- 部署：Vercel、Netlify（前端），Render、Heroku、AWS（后端）

---

## 三、详细分步开发流程（先前端后后端，先简单后复杂，每步开发测试查看效果）

### 0. 环境准备
1. 安装 Node.js、npm/yarn
2. 注册 Google Cloud（获取 OAuth 凭证）
3. 注册 Stripe（获取支付 API Key）
4. 注册图片处理 API（如 Replicate）

---

### 1. 前端开发流程

#### 1.1 初始化项目
- 使用 Next.js 创建项目
- 安装 Tailwind CSS、axios 等依赖
- 测试：运行开发服务器，访问首页，确保页面正常显示

#### 1.2 静态页面搭建
- 按照设计图实现首页、上传区、风格选择、按钮、FAQ、订阅等静态UI
- 测试：本地查看页面布局和样式，确保与设计图一致

#### 1.3 图片上传与本地预览
- 实现本地图片选择和预览（FileReader）
- 测试：选择本地图片后能即时预览

#### 1.4 Google 登录前端集成（仅UI，后端未接入）
- 集成 Firebase Auth，添加 Google 登录按钮
- 测试：点击按钮弹出 Google 登录窗口，能获取到用户信息（可先用 mock 数据）

#### 1.5 风格选择与转换按钮（仅UI）
- 实现风格下拉选择和"Transform Now"按钮
- 测试：切换风格、点击按钮有响应（可用弹窗或console.log模拟）

#### 1.6 结果图片预览与下载按钮（仅UI）
- 预留转换结果图片展示区和下载按钮
- 测试：上传图片后可显示"转换结果"占位图，点击下载按钮有响应

#### 1.7 免费次数与订阅提示（仅UI）
- 实现免费次数用尽后弹窗提示登录/订阅
- 测试：模拟次数用尽后弹窗提示

---

### 2. 后端开发流程

#### 2.1 初始化后端项目
- 新建 Express 或 Next.js API 项目，安装相关依赖
- 测试：实现一个简单API，前端可请求并拿到数据

#### 2.2 图片上传接口
- 实现图片上传API，接收前端图片并存储
- 测试：前端上传图片，后端能收到并保存

#### 2.3 Google 登录后端校验
- 实现Google Token校验，生成JWT，返回用户信息
- 测试：前端登录后能获取后端返回的用户信息和Token

#### 2.4 免费次数与用户状态校验
- 实现用户免费次数、订阅状态校验逻辑
- 测试：未登录/未订阅用户只能转换1次，超限后返回错误，前端弹窗提示

#### 2.5 Stripe 订阅后端集成
- 集成Stripe，创建订阅、取消订阅、Webhook监听
- 测试：前端发起订阅，能跳转Stripe支付，支付后回调并更新用户状态
- 测试订阅流程：
- 使用测试卡号：4242 4242 4242 4242
- 任何未来日期作为有效期
- 任何3位数字作为CVC
- 任何未来日期作为账单地址的邮编
- 监控订阅：
- 在Stripe Dashboard的 "Subscriptions" 部分查看订阅状态
- 在 "Events" 部分查看webhook事件
- 在 "Customers" 部分查看客户信息

#### 2.6 风格转换API对接
- 对接AI风格转换API（如Replicate），实现图片风格转换
- 测试：上传图片后能返回Ghibli风格图片，前端可展示

#### 2.7 结果图片下载接口
- 实现图片下载接口，校验用户权限
- 测试：前端点击下载按钮能下载高清图片

---

### 3. 联调与完善

#### 3.1 前后端联调
- 前端各功能对接后端API，完成整体流程
- 测试：完整体验从上传、转换、预览、下载、订阅、登录等全流程

#### 3.2 细节优化与响应式
- 按设计图完善FAQ、联系方式、移动端适配等细节
- 测试：多端浏览，确保体验一致

#### 3.3 上线前测试
- 全面测试所有功能，修复bug
- 测试：邀请朋友体验，收集反馈

---

## 四、开发顺序建议（分步开发测试）

1. 前端静态页面开发 → 测试
2. 前端图片上传与预览 → 测试
3. 前端Google登录UI → 测试
4. 前端风格选择与转换UI → 测试
5. 前端结果预览与下载UI → 测试
6. 后端初始化与API测试
7. 后端图片上传API → 测试
8. 后端Google登录校验 → 测试
9. 后端免费次数/订阅校验 → 测试
10. Stripe订阅后端 → 测试
11. 风格转换API对接 → 测试
12. 图片下载API → 测试
13. 前后端联调 → 测试
14. 细节完善与上线前测试

---

## 五、参考资料

- [Next.js 官方文档](https://nextjs.org/docs)
- [Firebase Auth Google 登录](https://firebase.google.com/docs/auth/web/google-signin)
- [Stripe 订阅文档](https://stripe.com/docs/billing/subscriptions/overview)
- [Replicate API 文档](https://replicate.com/docs/reference/http)
- [Multer 图片上传](https://github.com/expressjs/multer)

---

如需详细代码示例或遇到具体问题，可随时补充提问！

---

**保存方法**：将以上内容复制到 `开发流程文档.md` 文件中即可。 